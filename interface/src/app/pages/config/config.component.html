<div class="config-page animate-fadeInUp">
    <div class="page-header">
        <h1>Configuration</h1>
        <p>Gérer les règles de priorité et les paramètres système</p>
    </div>

    <div class="config-sections grid grid-1">

        <!-- Analysis Settings -->
        <div class="config-section card">
            <h2>Paramètre Analyse</h2>
            <p class="section-description">
                Configurer les paramètres et les seuils du modèle d'IA
            </p>

            <form [formGroup]="analysisForm" (ngSubmit)="saveAnalysisSettings()">
                <div class="form-group">
                    <label>Seuil Classification Binaire</label>
                    <input type="range" formControlName="binaryThreshold" class="range-input" min="0.1" max="0.9"
                        step="0.1">
                    <div class="range-value">{{ analysisForm.get('binaryThreshold')?.value }}</div>
                    <small>Confiance minimale pour la détection des menaces</small>
                </div>

                <div class="form-group">
                    <label>Seuil Haute Priorité</label>
                    <input type="range" formControlName="highPriorityThreshold" class="range-input" min="0.6" max="1.0"
                        step="0.05">
                    <div class="range-value">{{ analysisForm.get('highPriorityThreshold')?.value }}</div>
                    <small>Score minimum pour la classification de priorité haute</small>
                </div>

                <div class="form-group">
                    <label>Seuil Moyenne Priorité</label>
                    <input type="range" formControlName="mediumPriorityThreshold" class="range-input" min="0.3"
                        max="0.8" step="0.05">
                    <div class="range-value">{{ analysisForm.get('mediumPriorityThreshold')?.value }}</div>
                    <small>Score minimum pour la classification de priorité moyenne</small>
                </div>

                <div class="form-group">
                    <label>Activer Groupe Modulation</label>
                    <div class="toggle-switch">
                        <input type="checkbox" formControlName="enableGroupModulation" id="groupModulation">
                        <label for="groupModulation" class="toggle-label"></label>
                    </div>
                    <small>Appliquer des ajustements de priorité basés sur les groupes</small>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn" [disabled]="!analysisForm.valid">
                        Sauvegarder Paramètre
                    </button>
                    <button type="button" class="btn btn-danger" (click)="resetToDefaults()">
                        Redefinir Valeur Par Défaut
                    </button>
                </div>
            </form>
        </div>

        <!-- Priority Rules -->
        <div class="config-section card">
            <h2>Règle Priorité Groupe</h2>
            <p class="section-description">
                Définir comment les groupes d'utilisateurs affectent la classification des priorités des menaces
            </p>

            <form [formGroup]="priorityForm" (ngSubmit)="savePriorityRules()">
                <div formArrayName="groupRules" class="rules-list">
                    <div *ngFor="let rule of groupRulesArray.controls; let i = index" [formGroupName]="i"
                        class="rule-item">
                        <div class="rule-header">
                            <h4>Règle {{ i + 1 }}</h4>
                            <button type="button" class="btn btn-danger" (click)="removeRule(i)"
                                *ngIf="groupRulesArray.length > 1">
                                Supprimer
                            </button>
                        </div>

                        <div class="form-group">
                            <label>Nom du groupe</label>
                            <select formControlName="group" class="form-control">
                                <option value="executive">Équipe exécutive</option>
                                <option value="management">Direction</option>
                                <option value="developer">Équipe Développement</option>
                                <option value="analyst">Équipe SOC</option>
                                <option value="user">Utilisateur General</option>
                                <option value="contractor">Prestataire</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Multiplicateur Priorité</label>
                            <input type="number" formControlName="multiplier" class="form-control" min="0.1" max="3.0"
                                step="0.1">
                            <small>Les valeurs augmentent la priorité (1.0 = pas de changement)</small>
                        </div>

                        <div class="form-group">
                            <label>Description</label>
                            <textarea formControlName="description" class="form-control" rows="2"></textarea>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-success" (click)="addRule()">
                        Ajouter la Règle
                    </button>
                    <button type="submit" class="btn" [disabled]="!priorityForm.valid">
                        Sauvegarder Priorité
                    </button>
                </div>
            </form>
        </div>
        
    </div>

    <!-- Current Configuration Display -->
    <div class="current-config card">
        <h2>Configuration Actuelle</h2>
        <div class="config-display grid grid-2">
            <div class="config-group">
                <h3>Résumé Règles Priorité</h3>
                <div class="rules-summary">
                    <div *ngFor="let rule of getCurrentPriorityRules()" class="rule-summary">
                        <span class="group-name">{{ rule.group }}</span>
                        <span class="multiplier">×{{ rule.multiplier }}</span>
                    </div>
                </div>
            </div>

            <div class="config-group">
                <h3>Seuils Analyse</h3>
                <div class="thresholds-summary">
                    <div class="threshold-item">
                        <span>Classification Binaire:</span>
                        <span class="threshold-value">{{ analysisForm.get('binaryThreshold')?.value }}</span>
                    </div>
                    <div class="threshold-item">
                        <span>Haute Priorité:</span>
                        <span class="threshold-value">{{ analysisForm.get('highPriorityThreshold')?.value }}</span>
                    </div>
                    <div class="threshold-item">
                        <span>Moyenne Priorité:</span>
                        <span class="threshold-value">{{ analysisForm.get('mediumPriorityThreshold')?.value }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>